## QA-AUTO-PYTHON-BETTERSTORE-SUTSCH

_**Stack:
Python.version=3.9
Pytest=7.1.2
Allure-pytest=2.9.45
Selenium=4.1.3
Requests=2.27.1**_

- - -

Общее описание: Взаимодействие с web-интерфейсом СУЦШ реализовано посредством Selenium WebDriver. В проекте использован паттерн PageObject. При данной реализации, непосредственное взаимодействие с элементами веб-страниц осуществляется в классе BasePage (sutsch_ui/pages/base_page.py). Страницы СУЦШ, локаторы элементов на этих страницах и взаимодействие с элементами описаны в виде классов (Pages). Pages при этом наследуются от класса BasePage. Основная идея паттерна – отделить реализацию взаимодействия от логики тестов

- - -

1. Подготовка к работе:

- Клонируйте репозиторий или разместите его на своем диске

- Откройте проект через среду разработки (например PyCharm)

- Выберите интерпретатор (тесты писались на python 3.9)

- Создайте виртуальную среду

- Установите необходимые пакеты из requirements.txt

- Убедитесь что в настройках preferences -> tools -> Python Integrated Tools среди Default test runner выбран pytest

- - - -

2. Настройка проекта:

- Откройте файл config.py, в нем хранятся переменные, которые используются для тестов UI/API, вы можете добавить их в environment variables или заполнить вручную

##### Примечание: - в зависимости от используемой среды, из которой запускаются тесты, настройка может отличаться. При использовании:

- Bash – необходимо добавить соответствующие параметры в файл .bashrc, сохранить и выполнить команду “source ~/.bashrc” для применения настроек.

- Zsh – необходимо добавить соответствующие параметры в файл .zshrc, сохранить и выполнить команду “source ~/.zshrc ” для применения настроек.

- Windows CMD – изменения вносить под текущим пользователем. Для вступления в силу изменений может потребоваться перезагрузка.

- Для проверки внесенных изменений можно обратиться к переменным командой echo $PARAM_NAME (для Linux) и echo %PARAM% (для Windows). Например: echo $PATH или echo %PATH%

- - - -
3. Запуск тестов:

##### Примечание: При запуске pytest без указания имени файла будут запущены все файлы формата test _ *. Py или * _test.py в текущем каталоге и подкаталогах. Pytest автоматически определяет эти файлы как тестовые файлы. Мы можем заставить pytest запускать другие имена файлов, явно упоминая их.Pytest требует, чтобы имена тестовых функций начинались с test . Имена функций, которые не имеют формат test * , не считаются тестовыми функциями в pytest. Мы не можем явно заставить pytest рассматривать любую функцию, не начинающуюся с test, как тестовую функцию.

- В файле sutsch_ui/conftest.py можно изменить параметры запуска. По умолчанию: browser_name = chrome, headless =  true, language = null

- Ключи/флаги pytest:

```
флаг -v многословный пример stdout:
api/test_api_auth.py::test_post_cookie_user_valid PASSED

-q - тихий режим пример stdout:
1 passed in 0.14s

флаг -s вывод принтов в stdin
python pytest -s

флаг -m запуск маркированных тестов логин:
pytest -m login

запуск всех кроме маркированных devices:
python -m pytest -m "not forgot_pass"

остановить тесты после 1-го или n-го падения:
-x / --maxfail=n

запустить только последние упавшие
--lf

посмотреть все другие параметры
-h

собрать сведения о тестах:
--collect-only

Запуск всех имеющихся тестов: 
python -m pytest

Запуск конкретного теста из модуля:
pytest -v sutsch_api/test_api_auth.py::test_post_cookie_user_valid

Параметризованный запуск тестов страницы восстановления пароля под edge:
pytest -s -v --browser_name=edge test_forgotpass.py

Запуск всех тестов с формированием отсчета:
python -m pytest --alluredir=./allure-results

Формируем отсчет в аллюре:
allure serve ./allure-results
```

##### Примечание: Для запуска тестов под firefox необходимо: сгенерировать token в GitHub (settings>developer settings>personal access tokens>generate new token) и добавить его в переменные среды внутри проекта:

```
import os

os.environ['GH_TOKEN'] = "enter_youre_token"
```
- - - -
4. Статусы завершения :

```
Выполнение pytest может генерировать один из следующих статусов завершения:

Exit code 0

Все тесты были собраны и успешно прошли

Exit code 1

Тесты были собраны и запущены, но некоторые из них упали

Exit code 2

Выполнение тестов было прервано пользователем

Exit code 3

Во время выполнения тестов произошла внутренняя ошибка

Exit code 4

Ошибка запуска pytest из командной строки

Exit code 5

Не удалось собрать тесты (тесты не найдены)
```
- - - -
5. Структура проекта
 

├── README.md – руководство по установке, настройке и запуску

├── current_date_and_time - скрипт для получения текущей даты и времени

├── environment.properties - описание стэка проекта

├── playlist_name - скрипт для получения уникального имени плейлиста

├── pytest - основной конфигурационный файл pytest

├── requirements - требования об необходимых пакетах

│    ├── tests - директория с тестами

│    │     ├── sutsch_api - API тесты

│    │    │   └── class_api – модуль с реализацией взаимодействия с APIs

│    │    │ └── conftest – конфигурационный файл для PyTest + фикстуры

│    │    │  └── test_api_auth - тесты API авторизации

│    │    │  └── test_api_dashboard - тесты API дашборд

│    │    │ └── test_api_groups - тесты API группы

│    │    │ └── test_api_layout - тесты API макеты ценников

│    │    │ └── test_api_media - тесты API медиа

│    │    │ └── test_api_playlist - тесты API плейлист

│    │    │ └── test_api_shelf - тесты API цветная полка

│    │    │ └── test_api_tag- тесты API тэги

│    │    ├── sutsch_ui - UI тесты

│    │    │   ├── pages - модуль с реализацией страниц веб-приложения

│   │    │   │    └── base_page - базовая реализация для работы с веб-страницами

│   │    │   │     └── devices_page - реализация страницы Устройства 

│   │    │   │     └── forgot_password_page - реализация страницы Забыли пароль

│   │    │   │     └── layout_page - реализация страницы Макеты полки

│   │    │   │     └── locators - селекторы веб-элементов 

│   │    │   │     └── login_page - реализация страницы Авторизация

│   │    │   │     └── media_page - реализация страницы Медиа

│   │    │   │     └── playlist_page - реализация страницы Плейлисты

│   │    │  ├── screenshots - директория со скриншотами прохождения тестов

│   │    │   ├── config - конфигурационный файл проекта

│   │    │   ├── conftest - конфигурационный файл pytest

│   │    │   ├── randomizer_eng - скрипт получения случайного пароля на en/ru раскладке

│   │    │   ├── test_auth - тесты страницы Авторизация

│   │    │   ├── test_devices - тесты страницы Устройства

│   │    │   ├── test_forgotpass - тесты страницы Забыли пароль

│   │    │   ├── test_layout - тесты страницы Макеты полки

│   │    │   ├── test_media - тесты страницы Медиа

│   │    │   ├── test_playlist - тесты страницы Плейлист